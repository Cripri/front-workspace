<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #main {
            width: 800px;
            height: 600px;
            border: 3px solid black;
            background-color: skyblue;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 24px;
            text-align: center;
        }
        input, button {
            font-size: 20px;
            margin: 10px;
        }
        #screen{
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <h3># WebStorage API</h3>

    <ul>
        <li>자바스크립트로 웹 브라우저에 데이터를 보관할 수 있는 공간</li>
        <li>데이터를 key/value 형태로 보관해놓을 수 있다</li>
        <li>로컬 스토리지와 세션 스토리지가 있다</li>
        <li>로컬 스토리지는 웹 브라우저를 종료하더라고 데이터가 쭉 유지된다</li>
        <li>세션 스토리지는 웹 브라우저가 켜져 있는 동안만 데이터가 유지된다</li>
        <li>데이터는 문자열 형태로 저장된다</li>
    </ul>

    <h3>반응속도 테스트</h3>

    <div id="main">
        <div id="screen">
            <div>
                이름 입력 : <input type="text" id="input_name" />
            </div>
            <button id="start">시작</button>
        </div>
    </div>


    <script>
        //데이터 저장하기

        window.localStorage.setItem('score', 30000);
        window.localStorage.setItem('nickName', '빽사이즈 아메리카노');

        //Javascript Object를 문자열 형태로 변환하여 보관히기 위해서
        // JSON 형태의 문자열로 변환을 해야 한다
        let jsonStr = JSON.stringify('element', {
            name: '홍길동',
            age: 10,
            score: 500
        });

        window.localStorage.setItem('userInfo', jsonStr);
        

        window.sessionStorage.setItem('ligin', true);
        window.sessionStorage.setItem('lastAccessTime', Number(new Date()));

        //데이터 꺼내기
        console.log(window.localStorage.getItem('username'));
        console.log(window.localStorage.getItem('nickname'));

        //JSON형식의 데이터 꺼내기
        console.log(jsonStr = window.localStorage.getItem('userInfo'));

        // JSON -> Object
        const obj = JSON.parse(jsonStr);
        for(key in obj){
            console.log(`key ${key} : ${obj[key]}`);
        }

        console.log(typeof window.sessionStorage.getItem('login'));

        const main = document.getElementById('main');
        const screen = document.getElementById('screen');
        const inputName = document.getElementById('input_name');
        const startBtn = document.getElementById('start');

        let currentTry = 0;
        const MAX_TRIES = 5;
        let reactionTimes = [];
        let startTime;

        startBtn.addEventListener('click', () => {
            const username = inputName.value.trim();
                if (!username) {
                    alert("이름을 입력하세요!");
                    return;
                }

            sessionStorage.setItem('username', username);
            reactionTimes = [];
            currentTry = 0;
            showClickToStart();
        });

        function showClickToStart() {
            screen.innerHTML = `<p>(${currentTry++}/${MAX_TRIES}) 테스트<br><br>클릭하면 시작합니다</p>`;
            screen.style.backgroundColor = 'skyblue';
            screen.onclick = () => runReactionTest();
        }

        function runReactionTest() {
            screen.onclick = null;
            screen.textContent = '기다리세요...';
            screen.style.backgroundColor = 'skyblue';

            const delay = Math.floor(Math.random() * 4000) + 1000;

            setTimeout(() => {
                screen.textContent = '클릭!';
                screen.style.backgroundColor = 'green';
                startTime = Date.now();

                screen.onclick = () => {
                const reactionTime = Date.now() - startTime;
                reactionTimes.push(reactionTime);
                currentTry++;

                screen.onclick = null;
                screen.textContent = `반응속도: ${reactionTime} ms`;
                screen.style.backgroundColor = 'skyblue';

                if (currentTry < MAX_TRIES) {
                    setTimeout(showClickToStart, 1000);
                } else {
                    setTimeout(showResult, 1000);
                }
                };
            }, delay);
        }

        function showResult() {

            const avg = Math.round(reactionTimes.reduce((a, b) => a + b) / reactionTimes.length);
            const min = Math.min(...reactionTimes);
            const max = Math.max(...reactionTimes);
            const username = sessionStorage.getItem('username') || '사용자';

            screen.innerHTML = `
                <h2>${username}님의 결과</h2>
                <p> 평균: <b>${avg} ms</b></p>
                <p> 최고(빠름): <b>${min} ms</b></p>
                <p> 최저(느림): <b>${max} ms</b></p>
                <br>
                <button id="restart" onclick="location.reload()">다시 시작</button>
            `;
            screen.style.backgroundColor = 'white';
        }
    </script>
</body>
</html>